<div class="maincontent">
  <div id="error-message">
    <h3>No Error</h3>
  </div>
  <div id="success-message">
    <h3>No Message</h3>
  </div>
  <div class="card">
    <h3 id="control-meta-data-file">Control</h3>
      <form action="/restart" method="POST">
        <label for="fileSelect">Select a file:</label>
        <select name="config_file_path" id="fileSelect">
          <option value="NA">Loading...</option>
        </select>
        <br><br>

        <label for="versionSelect">Select a Version:</label>
        <select name="target_version" id="versionSelect">
          <option value="NA">Loading...</option>
        </select>
        <br><br>

        <label for="isForced">Force Restart When Jobs In Progress:</label>
        <select name="forced" id="isForced">
          <option value="No">False</option>
          <option value="Yes">True</option>
        </select>
        <br><br>

        <input type="submit" value="Load">
      </form>
  </div>
  <div class="row">
    <div class="card">
      <p class="subtext">Start Workers To Run Jobs</p>
      <br/>
      <form action="/start" method="GET">
        <button type="submit">Start</button>
      </form>
    </div>
    <div class="card">
      <p class="subtext">Stop Existing Workers</p>
      <br/>
      <form action="/stop" method="GET">
        <button type="submit">Stop</button>
      </form>
    </div>
  </div>
</div>
<script type="module">
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const error = urlParams.get('error');
  const success = urlParams.get('success');
  // if an error or success message provided
  if (error) {
    // Select the <h3> child of the div with id="error-message"
    const errorMessageH3 = document.querySelector("#error-message h3");
    if (errorMessageH3) {
      errorMessageH3.innerHTML = error;
      document.getElementById("error-message").style.display = "block";
    }
  } else if (success) {
    // Select the <h3> child of the div with id="success-message"
    const successMessageH3 = document.querySelector("#success-message h3");
    if (successMessageH3) {
      successMessageH3.innerHTML = success;
      document.getElementById("success-message").style.display = "block";
    }
  }

  const reqHeaders = new Headers();
  reqHeaders.append("Accept", "application/json");

  const configResponse = await fetch('/config_files',
    {
      method: "GET",
      headers: reqHeaders,
    }
  );
  const configObjs = await configResponse.json();
  var configOptions = ''
  if (configObjs != undefined) {
    for (let i = 0; i < configObjs.length; i++) {
      const parts = configObjs[i].split('/');
      const fileName = parts[parts.length - 1];
      configOptions += '<option value="'+configObjs[i]+'">'+fileName+'</option>'
    }
  } else {
    configOptions += '<option value="NA">No Options Returned</option>'
  }
  document.getElementById("fileSelect").innerHTML = configOptions

  const versionResponse = await fetch('/release_versions',
    {
      method: "GET",
      headers: reqHeaders,
    }
  );
  const versionObjs = await versionResponse.json();
  var versionOptions = '<option value="nochange">Keep Default</option>'

  if (versionObjs != undefined) {
    for (let i = 0; i < versionObjs.length; i++) {
      versionOptions += '<option value="'+versionObjs[i]+'">'+versionObjs[i]+'</option>'
    }
  } else {
    versionOptions += '<option value="NA">No Versions Returned</option>'
  }
  document.getElementById("versionSelect").innerHTML = versionOptions
</script>
